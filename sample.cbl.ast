(startRule (compilationUnit (programUnit (identificationDivision IDENTIFICATION DIVISION .\n        (programIdParagraph PROGRAM-ID .  (programName (cobolWord SALES-REPORT-SYSTEM)) .\n       ) (identificationDivisionBody (authorParagraph AUTHOR . ))))) PM Office Hino .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** * : * : * * - ( TENREP . TXT ) * - ( SHOREP . TXT ) * : PM Office Hino * : 2025-05-15 * : 2025-05-16 ( ) ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ENVIRONMENT DIVISION .\n        CONFIGURATION SECTION .\n        SOURCE-COMPUTER .  IBM-AIX .  OBJECT-COMPUTER .  IBM-AIX .  SPECIAL-NAMES .\n            CONSOLE IS SYSCONSOLE .  INPUT-OUTPUT SECTION .\n        FILE-CONTROL .\n            SELECT TENPO-MASTER-FILE ASSIGN TO "TENMAS.DAT" ORGANIZATION IS LINE SEQUENTIAL FILE STATUS IS FS-TENMAS .\n            SELECT SHOHIN-MASTER-FILE ASSIGN TO "SHOMAS.DAT" ORGANIZATION IS LINE SEQUENTIAL FILE STATUS IS FS-SHOMAS .\n            SELECT URIAGE-JISSEKI-FILE ASSIGN TO "URIDAT.DAT" ORGANIZATION IS LINE SEQUENTIAL FILE STATUS IS FS-URIAGE .\n            SELECT TENPO-REPORT-FILE ASSIGN TO "TENREP.TXT" ORGANIZATION IS LINE SEQUENTIAL FILE STATUS IS FS-TENREP .\n            SELECT SHOHIN-REPORT-FILE ASSIGN TO "SHOREP.TXT" ORGANIZATION IS LINE SEQUENTIAL FILE STATUS IS FS-SHOREP .\n\n        DATA DIVISION .\n        FILE SECTION .\n        FD TENPO-MASTER-FILE .\n        01 TENPO-MASTER-RECORD .\n            05 TM-CODE PIC 9 ( 03 ) .\n            05 TM-NAME PIC X ( 20 ) .\n\n        FD SHOHIN-MASTER-FILE .\n        01 SHOHIN-MASTER-RECORD .\n            05 SM-CODE PIC X ( 04 ) .\n            05 SM-NAME PIC X ( 30 ) .\n            05 SM-PRICE PIC 9 ( 05 ) .\n\n        FD URIAGE-JISSEKI-FILE .\n        01 URIAGE-JISSEKI-RECORD .\n            05 UJ-DATE PIC 9 ( 08 ) .\n            05 UJ-TENPO-CODE PIC 9 ( 03 ) .\n            05 UJ-SHOHIN-CODE PIC X ( 04 ) .\n            05 UJ-QUANTITY PIC 9 ( 03 ) .\n            05 UJ-AMOUNT PIC 9 ( 07 ) .\n\n        FD TENPO-REPORT-FILE .\n        01 TENPO-REPORT-LINE PIC X ( 80 ) .\n\n        FD SHOHIN-REPORT-FILE .\n        01 SHOHIN-REPORT-LINE PIC X ( 120 ) .\n\n        WORKING-STORAGE SECTION .\n       * File Status 01 FILE-STATUS-FIELDS .\n            05 FS-TENMAS PIC XX .\n            05 FS-SHOMAS PIC XX .\n            05 FS-URIAGE PIC XX .\n            05 FS-TENREP PIC XX .\n            05 FS-SHOREP PIC XX .\n\n       * Flags and Counters 01 WS-EOF-FLAGS .\n            05 WS-TENMAS-EOF-FLG PIC X VALUE 'N' .\n               88 TENMAS-EOF VALUE 'Y' .\n            05 WS-SHOMAS-EOF-FLG PIC X VALUE 'N' .\n               88 SHOMAS-EOF VALUE 'Y' .\n            05 WS-URIAGE-EOF-FLG PIC X VALUE 'N' .\n               88 URIAGE-EOF VALUE 'Y' .\n\n        01 WS-USER-CHOICE PIC X ( 1 ) .\n        01 WS-REPORT-DATE .\n            05 WS-REPORT-YYYY PIC 9 ( 04 ) VALUE 2025 .  05 WS-REPORT-MM PIC 9 ( 02 ) VALUE 04 .    01 WS-REPORT-YYYYMM PIC X ( 06 ) VALUE "202504" .  01 WS-MAX-TENPO PIC 9 ( 02 ) VALUE 10 .  01 WS-MAX-SHOHIN PIC 9 ( 02 ) VALUE 30 .  01 WS-LOADED-TENPO-COUNT PIC 9 ( 02 ) VALUE 0 .\n        01 WS-LOADED-SHOHIN-COUNT PIC 9 ( 02 ) VALUE 0 .\n\n       * Store Master Data 01 WS-TENPO-MASTER-TABLE .\n            05 WS-TENPO-ENTRIES OCCURS 10 TIMES INDEXED BY TM-IDX .\n               10 WS-TM-CODE PIC 9 ( 03 ) .\n               10 WS-TM-NAME PIC X ( 20 ) .\n\n        01 WS-SHOHIN-MASTER-TABLE .\n            05 WS-SHOHIN-ENTRIES OCCURS 30 TIMES INDEXED BY SM-IDX .\n               10 WS-SM-CODE PIC X ( 04 ) .\n               10 WS-SM-NAME PIC X ( 30 ) .\n               10 WS-SM-PRICE PIC 9 ( 05 ) .\n\n       * For Tenpo Report 01 WS-TENPO-SALES-TABLE .\n            05 WS-TENPO-SALES-ENTRIES OCCURS 10 TIMES INDEXED BY TS-IDX .\n               10 WS-TS-TENPO-CODE PIC 9 ( 03 ) .\n               10 WS-TS-TENPO-NAME PIC X ( 20 ) .\n               10 WS-TS-MONTHLY-SALES PIC 9 ( 09 ) VALUE 0 .\n        01 WS-GRAND-TOTAL-SALES PIC 9 ( 10 ) VALUE 0 .\n        01 WS-EDITED-AMOUNT PIC ZZZ , ZZZ , ZZ9 .\n        01 WS-EDITED-GRAND-TOTAL PIC ZZZ , ZZZ , ZZZ , ZZ9 .\n\n       * For Shohin Report 01 WS-SHOHIN-SALES-TABLE .\n            05 WS-SHOHIN-SALES-ENTRIES OCCURS 30 TIMES INDEXED BY SS-IDX .\n               10 WS-SS-SHOHIN-CODE PIC X ( 04 ) .\n               10 WS-SS-SHOHIN-NAME PIC X ( 30 ) .\n               10 WS-SS-TOTAL-QTY-ED PIC ZZZZ9 .\n               10 WS-SS-TOTAL-AMT-ED PIC ZZZ , ZZZ , ZZ9 .\n               10 WS-SS-NUM-TOTAL-AMT PIC 9 ( 09 ) VALUE 0 .\n               10 WS-SS-NUM-TOTAL-QTY PIC 9 ( 05 ) VALUE 0 .\n               10 WS-SS-TENPO-DETAILS OCCURS 10 TIMES INDEXED BY SST-IDX .\n                  15 WS-SST-TENPO-CODE PIC 9 ( 03 ) .\n                  15 WS-SST-TENPO-NAME PIC X ( 20 ) .\n                  15 WS-SST-QTY-ED PIC ZZZZ9 .\n                  15 WS-SST-AMT-ED PIC ZZZ , ZZZ , ZZ9 .\n                  15 WS-SST-NUM-QTY PIC 9 ( 05 ) VALUE 0 .\n                  15 WS-SST-NUM-AMT PIC 9 ( 09 ) VALUE 0 .\n\n        01 WS-SHOHIN-GRAND-TOTAL-AMT-ED PIC ZZZ , ZZZ , ZZZ , ZZ9 .\n        01 WS-SHOHIN-NUM-GRAND-TOTAL-AMT PIC 9 ( 10 ) VALUE 0 .\n\n       * Report Line Definitions 01 WS-PRINT-LINE PIC X ( 120 ) .\n        01 WS-DASHES-50 PIC X ( 50 ) VALUE ALL "-" .\n        01 WS-DASHES-80 PIC X ( 80 ) VALUE ALL "-" .\n        01 WS-DASHES-100 PIC X ( 100 ) VALUE ALL "-" .\n        01 WS-DASHES-120 PIC X ( 120 ) VALUE ALL "-" .\n\n        01 WS-TENREP-HEADER1 PIC X ( 80 ) .\n        01 WS-TENREP-HEADER2 .\n            05 FILLER PIC X ( 12 ) VALUE "店舗コード 店舗名" .\n            05 FILLER PIC X ( 22 ) VALUE SPACES .  05 FILLER PIC X ( 12 ) VALUE "月間売上金額" .\n        01 WS-TENREP-DETAIL-LINE .\n            05 WS-TRD-CODE PIC 9 ( 03 ) .\n            05 FILLER PIC X ( 02 ) VALUE SPACES .\n            05 WS-TRD-NAME PIC X ( 20 ) .\n            05 FILLER PIC X ( 02 ) VALUE SPACES .\n            05 FILLER PIC X ( 01 ) VALUE "¥" .\n            05 WS-TRD-AMOUNT PIC ZZZ , ZZZ , ZZ9 .\n            05 FILLER PIC X ( 39 ) VALUE SPACES .  01 WS-TENREP-TOTAL-LINE .\n            05 FILLER PIC X ( 27 ) VALUE "合計" .\n            05 FILLER PIC X ( 01 ) VALUE "¥" .\n            05 WS-TRT-GRAND-TOTAL PIC ZZZ , ZZZ , ZZZ , ZZ9 .\n            05 FILLER PIC X ( 38 ) VALUE SPACES .  01 WS-SHOREP-HEADER1 PIC X ( 120 ) .\n        01 WS-SHOREP-HEADER2 .\n            05 FILLER PIC X ( 11 ) VALUE "商品コード 商品名" .\n            05 FILLER PIC X ( 40 ) VALUE SPACES .\n            05 FILLER PIC X ( 10 ) VALUE "総販売数量" .\n            05 FILLER PIC X ( 5 ) VALUE SPACES .\n            05 FILLER PIC X ( 12 ) VALUE "総販売金額" .\n        01 WS-SHOREP-HEADER3 .\n            05 FILLER PIC X ( 02 ) VALUE SPACES .\n            05 FILLER PIC X ( 12 ) VALUE "店舗コード 店舗名" .\n            05 FILLER PIC X ( 22 ) VALUE SPACES .\n            05 FILLER PIC X ( 08 ) VALUE "販売数量" .\n            05 FILLER PIC X ( 5 ) VALUE SPACES .\n            05 FILLER PIC X ( 08 ) VALUE "販売金額" .\n        01 WS-SHOREP-DETAIL1-LINE .\n            05 WS-SRD1-CODE PIC X ( 04 ) .\n            05 FILLER PIC X ( 01 ) VALUE SPACE .\n            05 WS-SRD1-NAME PIC X ( 30 ) .\n            05 FILLER PIC X ( 06 ) VALUE SPACES .\n            05 WS-SRD1-TOTAL-QTY PIC ZZZZ9 .\n            05 FILLER PIC X ( 05 ) VALUE SPACES .\n            05 FILLER PIC X ( 01 ) VALUE "¥" .\n            05 WS-SRD1-TOTAL-AMT PIC ZZZ , ZZZ , ZZ9 .\n        01 WS-SHOREP-DETAIL2-LINE .\n            05 FILLER PIC X ( 02 ) VALUE SPACES .\n            05 WS-SRD2-TENPO-CODE PIC 9 ( 03 ) .\n            05 FILLER PIC X ( 01 ) VALUE SPACE .\n            05 WS-SRD2-TENPO-NAME PIC X ( 20 ) .\n            05 FILLER PIC X ( 03 ) VALUE SPACES .\n            05 WS-SRD2-QTY PIC ZZZZ9 .\n            05 FILLER PIC X ( 05 ) VALUE SPACES .\n            05 FILLER PIC X ( 01 ) VALUE "¥" .\n            05 WS-SRD2-AMT PIC ZZZ , ZZZ , ZZ9 .\n        01 WS-SHOREP-TOTAL-LINE .\n            05 FILLER PIC X ( 57 ) VALUE "総合計" .\n            05 FILLER PIC X ( 05 ) VALUE SPACES .\n            05 FILLER PIC X ( 01 ) VALUE "¥" .\n            05 WS-SRT-GRAND-TOTAL PIC ZZZ , ZZZ , ZZZ , ZZ9 .\n\n\n        PROCEDURE DIVISION .\n        MAIN-PROCEDURE .\n            PERFORM 1000-INITIALIZE-PROCESS .\n\n            PERFORM UNTIL WS-USER-CHOICE = '9' PERFORM 2000-USER-INPUT-ROUTINE EVALUATE WS-USER-CHOICE WHEN '1' PERFORM 3000-CREATE-TENPO-REPORT WHEN '2' PERFORM 4000-CREATE-SHOHIN-REPORT WHEN '9' DISPLAY "処理を終了します。" UPON SYSCONSOLE WHEN OTHER DISPLAY "無効な選択です。再度入力してください。" UPON SYSCONSOLE END-EVALUATE END-PERFORM .\n\n            PERFORM 9000-TERMINATE-PROCESS .\n            STOP RUN .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 1000-INITIALIZE-PROCESS .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** DISPLAY "処理を開始します。" UPON SYSCONSOLE .\n            INITIALIZE WS-TENPO-MASTER-TABLE WS-SHOHIN-MASTER-TABLE .\n            INITIALIZE WS-TENPO-SALES-TABLE WS-SHOHIN-SALES-TABLE .\n\n            PERFORM 1100-LOAD-TENPO-MASTER .\n            PERFORM 1200-LOAD-SHOHIN-MASTER .\n            PERFORM 1300-PREPARE-SALES-TABLES .\n            PERFORM 1400-DETERMINE-REPORT-MONTH .\n            DISPLAY "初期処理完了。" UPON SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 1100-LOAD-TENPO-MASTER .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN INPUT TENPO-MASTER-FILE .\n            IF FS-TENMAS NOT = "00" AND FS-TENMAS NOT = "05" * 05 : Optional file not found for some systems DISPLAY "エラー: 店舗マスターファイルを開けません。STATUS: " FS-TENMAS UPON SYSCONSOLE PERFORM 9000-TERMINATE-PROCESS STOP RUN END-IF .\n\n            SET TENMAS-EOF TO FALSE .\n            MOVE 0 TO WS-LOADED-TENPO-COUNT .\n            PERFORM VARYING TM-IDX FROM 1 BY 1 UNTIL TENMAS-EOF OR TM-IDX > WS-MAX-TENPO READ TENPO-MASTER-FILE AT END SET TENMAS-EOF TO TRUE NOT AT END ADD 1 TO WS-LOADED-TENPO-COUNT MOVE TM-CODE TO WS-TM-CODE ( TM-IDX ) MOVE TM-NAME TO WS-TM-NAME ( TM-IDX ) END-READ END-PERFORM .\n            CLOSE TENPO-MASTER-FILE .\n\n            IF WS-LOADED-TENPO-COUNT = 0 DISPLAY "エラー: 店舗マスターが読み込めませんでした。" UPON SYSCONSOLE PERFORM 9000-TERMINATE-PROCESS STOP RUN END-IF .\n            DISPLAY "店舗マスター読み込み完了: " WS-LOADED-TENPO-COUNT "件" UPON SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 1200-LOAD-SHOHIN-MASTER .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN INPUT SHOHIN-MASTER-FILE .\n            IF FS-SHOMAS NOT = "00" AND FS-SHOMAS NOT = "05" DISPLAY "エラー: 商品マスターファイルを開けません。STATUS: " FS-SHOMAS UPON SYSCONSOLE PERFORM 9000-TERMINATE-PROCESS STOP RUN END-IF .\n\n            SET SHOMAS-EOF TO FALSE .\n            MOVE 0 to WS-LOADED-SHOHIN-COUNT .\n            PERFORM VARYING SM-IDX FROM 1 BY 1 UNTIL SHOMAS-EOF OR SM-IDX > WS-MAX-SHOHIN READ SHOHIN-MASTER-FILE AT END SET SHOMAS-EOF TO TRUE NOT AT END ADD 1 TO WS-LOADED-SHOHIN-COUNT MOVE SM-CODE TO WS-SM-CODE ( SM-IDX ) MOVE SM-NAME TO WS-SM-NAME ( SM-IDX ) MOVE SM-PRICE TO WS-SM-PRICE ( SM-IDX ) END-READ END-PERFORM .\n            CLOSE SHOHIN-MASTER-FILE .\n\n            IF WS-LOADED-SHOHIN-COUNT = 0 DISPLAY "エラー: 商品マスターが読み込めませんでした。" UPON SYSCONSOLE PERFORM 9000-TERMINATE-PROCESS STOP RUN END-IF .\n            DISPLAY "商品マスター読み込み完了: " WS-LOADED-SHOHIN-COUNT "件" UPON SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 1300-PREPARE-SALES-TABLES .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** * Initialize Tenpo Sales Table with master data PERFORM VARYING TS-IDX FROM 1 BY 1 UNTIL TS-IDX > WS-LOADED-TENPO-COUNT MOVE WS-TM-CODE ( TS-IDX ) TO WS-TS-TENPO-CODE ( TS-IDX ) MOVE WS-TM-NAME ( TS-IDX ) TO WS-TS-TENPO-NAME ( TS-IDX ) MOVE 0 TO WS-TS-MONTHLY-SALES ( TS-IDX ) END-PERFORM .\n            MOVE 0 TO WS-GRAND-TOTAL-SALES .\n\n       * Initialize Shohin Sales Table with master data PERFORM VARYING SS-IDX FROM 1 BY 1 UNTIL SS-IDX > WS-LOADED-SHOHIN-COUNT MOVE WS-SM-CODE ( SS-IDX ) TO WS-SS-SHOHIN-CODE ( SS-IDX ) MOVE WS-SM-NAME ( SS-IDX ) TO WS-SS-SHOHIN-NAME ( SS-IDX ) MOVE 0 TO WS-SS-NUM-TOTAL-QTY ( SS-IDX ) MOVE 0 TO WS-SS-NUM-TOTAL-AMT ( SS-IDX ) PERFORM VARYING SST-IDX FROM 1 BY 1 UNTIL SST-IDX > WS-LOADED-TENPO-COUNT MOVE WS-TM-CODE ( SST-IDX ) TO WS-SST-TENPO-CODE ( SS-IDX SST-IDX ) MOVE WS-TM-NAME ( SST-IDX ) TO WS-SST-TENPO-NAME ( SS-IDX SST-IDX ) MOVE 0 TO WS-SST-NUM-QTY ( SS-IDX SST-IDX ) MOVE 0 TO WS-SST-NUM-AMT ( SS-IDX SST-IDX ) END-PERFORM END-PERFORM .\n            MOVE 0 TO WS-SHOHIN-NUM-GRAND-TOTAL-AMT .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 1400-DETERMINE-REPORT-MONTH .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN INPUT URIAGE-JISSEKI-FILE .\n            IF FS-URIAGE NOT = "00" AND FS-URIAGE NOT = "05" DISPLAY "エラー: 販売実績ファイルを開けません。STATUS: " FS-URIAGE UPON SYSCONSOLE CLOSE URIAGE-JISSEKI-FILE DISPLAY "デフォルト年月 (" WS-REPORT-YYYYMM ") を使用します。" UPON SYSCONSOLE EXIT PARAGRAPH END-IF .\n\n            SET URIAGE-EOF TO FALSE .\n            READ URIAGE-JISSEKI-FILE AT END SET URIAGE-EOF TO TRUE DISPLAY "エラー: 販売実績ファイルが空です。" UPON SYSCONSOLE DISPLAY "デフォルト年月 (" WS-REPORT-YYYYMM ") を使用します。" UPON SYSCONSOLE NOT AT END MOVE UJ-DATE ( 1 : 4 ) TO WS-REPORT-YYYY MOVE UJ-DATE ( 5 : 2 ) TO WS-REPORT-MM MOVE UJ-DATE ( 1 : 6 ) TO WS-REPORT-YYYYMM END-READ .\n            CLOSE URIAGE-JISSEKI-FILE .\n            DISPLAY "報告対象年月: " WS-REPORT-YYYY "年" WS-REPORT-MM "月" UPON SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 2000-USER-INPUT-ROUTINE .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** DISPLAY " " UPON SYSCONSOLE .\n            DISPLAY "------------------------------------" UPON SYSCONSOLE .\n            DISPLAY "帳票作成メニュー" UPON SYSCONSOLE .\n            DISPLAY "1: 店舗別月間売上実績表" UPON SYSCONSOLE .\n            DISPLAY "2: 商品別販売実績表" UPON SYSCONSOLE .\n            DISPLAY "9: 終了" UPON SYSCONSOLE .\n            DISPLAY "------------------------------------" UPON SYSCONSOLE .\n            DISPLAY "番号を選択: " WITH NO ADVANCING UPON SYSCONSOLE .\n            ACCEPT WS-USER-CHOICE FROM SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 3000-CREATE-TENPO-REPORT .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** DISPLAY "店舗別月間売上実績表を作成します..." UPON SYSCONSOLE .\n            PERFORM 3100-RESET-TENPO-SALES .\n            PERFORM 3200-CALCULATE-TENPO-SALES .\n            PERFORM 3300-PRINT-TENPO-REPORT .\n            DISPLAY "店舗別月間売上実績表を TENREP.TXT に出力しました。" UPON SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 3100-RESET-TENPO-SALES .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** PERFORM VARYING TS-IDX FROM 1 BY 1 UNTIL TS-IDX > WS-LOADED-TENPO-COUNT MOVE 0 TO WS-TS-MONTHLY-SALES ( TS-IDX ) END-PERFORM .\n            MOVE 0 TO WS-GRAND-TOTAL-SALES .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 3200-CALCULATE-TENPO-SALES .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN INPUT URIAGE-JISSEKI-FILE .\n            IF FS-URIAGE NOT = "00" AND FS-URIAGE NOT = "05" DISPLAY "エラー(集計用): 販売実績ファイルを開けません。FS: " FS-URIAGE UPON SYSCONSOLE EXIT PARAGRAPH END-IF .\n\n            SET URIAGE-EOF TO FALSE .\n            READ URIAGE-JISSEKI-FILE AT END SET URIAGE-EOF TO TRUE END-READ .\n\n            PERFORM UNTIL URIAGE-EOF PERFORM VARYING TS-IDX FROM 1 BY 1 UNTIL TS-IDX > WS-LOADED-TENPO-COUNT IF UJ-TENPO-CODE = WS-TS-TENPO-CODE ( TS-IDX ) ADD UJ-AMOUNT TO WS-TS-MONTHLY-SALES ( TS-IDX ) ADD UJ-AMOUNT TO WS-GRAND-TOTAL-SALES EXIT PERFORM END-IF END-PERFORM READ URIAGE-JISSEKI-FILE AT END SET URIAGE-EOF TO TRUE END-READ END-PERFORM .\n            CLOSE URIAGE-JISSEKI-FILE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 3300-PRINT-TENPO-REPORT .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN OUTPUT TENPO-REPORT-FILE .\n            IF FS-TENREP NOT = "00" DISPLAY "エラー: 店舗別帳票ファイルを開けません。STATUS: " FS-TENREP UPON SYSCONSOLE EXIT PARAGRAPH END-IF .\n\n       * Header STRING "店舗別月間売上実績表 (" WS-REPORT-YYYY "年" WS-REPORT-MM "月)" DELIMITED BY SIZE INTO WS-TENREP-HEADER1 .\n            WRITE TENPO-REPORT-LINE FROM WS-TENREP-HEADER1 .\n            WRITE TENPO-REPORT-LINE FROM WS-DASHES-50 .\n            WRITE TENPO-REPORT-LINE FROM WS-TENREP-HEADER2 .\n            WRITE TENPO-REPORT-LINE FROM WS-DASHES-50 .\n\n       * Detail PERFORM VARYING TS-IDX FROM 1 BY 1 UNTIL TS-IDX > WS-LOADED-TENPO-COUNT MOVE WS-TS-TENPO-CODE ( TS-IDX ) TO WS-TRD-CODE MOVE WS-TS-TENPO-NAME ( TS-IDX ) TO WS-TRD-NAME MOVE WS-TS-MONTHLY-SALES ( TS-IDX ) TO WS-TRD-AMOUNT WRITE TENPO-REPORT-LINE FROM WS-TENREP-DETAIL-LINE END-PERFORM .\n\n       * Footer WRITE TENPO-REPORT-LINE FROM WS-DASHES-50 .\n            MOVE WS-GRAND-TOTAL-SALES TO WS-TRT-GRAND-TOTAL .\n            WRITE TENPO-REPORT-LINE FROM WS-TENREP-TOTAL-LINE .\n            CLOSE TENPO-REPORT-FILE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 4000-CREATE-SHOHIN-REPORT .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** DISPLAY "商品別販売実績表を作成します..." UPON SYSCONSOLE .\n            PERFORM 4100-RESET-SHOHIN-SALES .\n            PERFORM 4200-CALCULATE-SHOHIN-SALES .\n            PERFORM 4300-PRINT-SHOHIN-REPORT .\n            DISPLAY "商品別販売実績表を SHOREP.TXT に出力しました。" UPON SYSCONSOLE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 4100-RESET-SHOHIN-SALES .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** PERFORM VARYING SS-IDX FROM 1 BY 1 UNTIL SS-IDX > WS-LOADED-SHOHIN-COUNT MOVE 0 TO WS-SS-NUM-TOTAL-QTY ( SS-IDX ) MOVE 0 TO WS-SS-NUM-TOTAL-AMT ( SS-IDX ) PERFORM VARYING SST-IDX FROM 1 BY 1 UNTIL SST-IDX > WS-LOADED-TENPO-COUNT MOVE 0 TO WS-SST-NUM-QTY ( SS-IDX SST-IDX ) MOVE 0 TO WS-SST-NUM-AMT ( SS-IDX SST-IDX ) END-PERFORM END-PERFORM .\n            MOVE 0 TO WS-SHOHIN-NUM-GRAND-TOTAL-AMT .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 4200-CALCULATE-SHOHIN-SALES .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN INPUT URIAGE-JISSEKI-FILE .\n            IF FS-URIAGE NOT = "00" AND FS-URIAGE NOT = "05" DISPLAY "エラー(集計用): 販売実績ファイルを開けません。FS: " FS-URIAGE UPON SYSCONSOLE EXIT PARAGRAPH END-IF .\n\n            SET URIAGE-EOF TO FALSE .\n            READ URIAGE-JISSEKI-FILE AT END SET URIAGE-EOF TO TRUE END-READ .\n\n            PERFORM UNTIL URIAGE-EOF PERFORM VARYING SS-IDX FROM 1 BY 1 UNTIL SS-IDX > WS-LOADED-SHOHIN-COUNT IF UJ-SHOHIN-CODE = WS-SS-SHOHIN-CODE ( SS-IDX ) ADD UJ-QUANTITY TO WS-SS-NUM-TOTAL-QTY ( SS-IDX ) ADD UJ-AMOUNT TO WS-SS-NUM-TOTAL-AMT ( SS-IDX ) ADD UJ-AMOUNT TO WS-SHOHIN-NUM-GRAND-TOTAL-AMT PERFORM VARYING SST-IDX FROM 1 BY 1 UNTIL SST-IDX > WS-LOADED-TENPO-COUNT IF UJ-TENPO-CODE = WS-SST-TENPO-CODE ( SS-IDX SST-IDX ) ADD UJ-QUANTITY TO WS-SST-NUM-QTY ( SS-IDX SST-IDX ) ADD UJ-AMOUNT TO WS-SST-NUM-AMT ( SS-IDX SST-IDX ) EXIT PERFORM END-IF END-PERFORM EXIT PERFORM END-IF END-PERFORM READ URIAGE-JISSEKI-FILE AT END SET URIAGE-EOF TO TRUE END-READ END-PERFORM .\n            CLOSE URIAGE-JISSEKI-FILE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 4300-PRINT-SHOHIN-REPORT .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** OPEN OUTPUT SHOHIN-REPORT-FILE .\n            IF FS-SHOREP NOT = "00" DISPLAY "エラー: 商品別帳票ファイルを開けません。STATUS: " FS-SHOREP UPON SYSCONSOLE EXIT PARAGRAPH END-IF .\n\n       * Header STRING "商品別販売実績表 (" WS-REPORT-YYYY "年" WS-REPORT-MM "月)" DELIMITED BY SIZE INTO WS-SHOREP-HEADER1 .\n            WRITE SHOHIN-REPORT-LINE FROM WS-SHOREP-HEADER1 .\n            WRITE SHOHIN-REPORT-LINE FROM WS-DASHES-100 .\n            WRITE SHOHIN-REPORT-LINE FROM WS-SHOREP-HEADER2 .\n            WRITE SHOHIN-REPORT-LINE FROM WS-SHOREP-HEADER3 .\n            WRITE SHOHIN-REPORT-LINE FROM WS-DASHES-100 .\n\n       * Detail PERFORM VARYING SS-IDX FROM 1 BY 1 UNTIL SS-IDX > WS-LOADED-SHOHIN-COUNT IF WS-SS-NUM-TOTAL-QTY ( SS-IDX ) > 0 OR WS-SS-NUM-TOTAL-AMT ( SS-IDX ) > 0 MOVE WS-SS-SHOHIN-CODE ( SS-IDX ) TO WS-SRD1-CODE MOVE WS-SS-SHOHIN-NAME ( SS-IDX ) TO WS-SRD1-NAME MOVE WS-SS-NUM-TOTAL-QTY ( SS-IDX ) TO WS-SRD1-TOTAL-QTY MOVE WS-SS-NUM-TOTAL-AMT ( SS-IDX ) TO WS-SRD1-TOTAL-AMT WRITE SHOHIN-REPORT-LINE FROM WS-SHOREP-DETAIL1-LINE PERFORM VARYING SST-IDX FROM 1 BY 1 UNTIL SST-IDX > WS-LOADED-TENPO-COUNT IF WS-SST-NUM-QTY ( SS-IDX SST-IDX ) > 0 OR WS-SST-NUM-AMT ( SS-IDX SST-IDX ) > 0 MOVE WS-SST-TENPO-CODE ( SS-IDX SST-IDX ) TO WS-SRD2-TENPO-CODE MOVE WS-SST-TENPO-NAME ( SS-IDX SST-IDX ) TO WS-SRD2-TENPO-NAME MOVE WS-SST-NUM-QTY ( SS-IDX SST-IDX ) TO WS-SRD2-QTY MOVE WS-SST-NUM-AMT ( SS-IDX SST-IDX ) TO WS-SRD2-AMT WRITE SHOHIN-REPORT-LINE FROM WS-SHOREP-DETAIL2-LINE END-IF END-PERFORM END-IF END-PERFORM .\n\n       * Footer WRITE SHOHIN-REPORT-LINE FROM WS-DASHES-100 .\n            MOVE WS-SHOHIN-NUM-GRAND-TOTAL-AMT TO WS-SRT-GRAND-TOTAL .\n            WRITE SHOHIN-REPORT-LINE FROM WS-SHOREP-TOTAL-LINE .\n            CLOSE SHOHIN-REPORT-FILE .\n\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** 9000-TERMINATE-PROCESS .\n       ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** ** DISPLAY " " UPON SYSCONSOLE .\n            CLOSE TENPO-MASTER-FILE SHOHIN-MASTER-FILE URIAGE-JISSEKI-FILE TENPO-REPORT-FILE SHOHIN-REPORT-FILE .\n       * Implicit close if files are not open but good practice END PROGRAM SALES-REPORT-SYSTEM .)